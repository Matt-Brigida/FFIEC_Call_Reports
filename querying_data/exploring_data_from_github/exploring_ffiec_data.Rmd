---
title: "Exploring FFIEC Data"
output: html_document
runtime: shiny
editor_options:
  chunk_output_type: inline
---

This notebook is a first look at the ffiec data.

### The Banks

```{r echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
## use DT to print the bulk POR for any quarter we choose (maybe have to convert to shiny doc)
library(DT)
library(shiny)
report.dates <- c("03312001", "06302001", "09302001", "12312001", "03312002", "06302002", "09302002", "12312002", "03312003", "06302003", "09302003", "12312003", "03312004", "06302004", "09302004", "12312004", "03312005", "06302005", "09302005", "12312005", "03312006", "06302006", "09302006", "12312006", "03312007", "06302007", "09302007", "12312007", "03312008", "06302008", "09302008", "12312008", "03312009", "06302009", "09302009", "12312009", "03312010", "06302010", "09302010", "12312010", "03312011", "06302011", "09302011", "12312011", "03312012", "06302012", "09302012", "12312012", "03312013", "06302013", "09302013", "12312013", "03312014", "06302014", "09302014", "12312014", "03312015", "06302015", "09302015", "12312015", "03312016", "06302016", "09302016", "12312016", "03312017", "06302017")
inputPanel(

selectizeInput("quarter_bulk_por", "Choose a Quarter", choices = report.dates)

)

DT::renderDataTable({
    githubURL <- paste0("https://github.com/Matt-Brigida/FFIEC_Call_Reports/blob/master/data/", input$quarter_bulk_por, "/bulk_POR_", input$quarter_bulk_por, ".rds?raw=true")
    bulk_por <- readRDS(url(githubURL))
    datatable(bulk_por)
})
```


### The Number of Banks Over Time

Below we calculate the number of unique IDRSSD codes (bank identifiers) each quarter. This may not track the number of bank (as in the 2012 increase) if the FDIC changes the types of institutions they cover (and are included in these reports) over time.  That said, the data shows the correct downward trend. 

```{r echo=FALSE, message=FALSE, warning=FALSE, error=FALSE, eval = FALSE}
library(quantmod)
library(highcharter)

renderHighchart({
reports <- c("03312001/bulk_POR_03312001.rds", "06302001/bulk_POR_06302001.rds", "09302001/bulk_POR_09302001.rds", "12312001/bulk_POR_12312001.rds", "03312002/bulk_POR_03312002.rds", "06302002/bulk_POR_06302002.rds", "09302002/bulk_POR_09302002.rds", "12312002/bulk_POR_12312002.rds", "03312003/bulk_POR_03312003.rds", "06302003/bulk_POR_06302003.rds", "09302003/bulk_POR_09302003.rds", "12312003/bulk_POR_12312003.rds", "03312004/bulk_POR_03312004.rds", "06302004/bulk_POR_06302004.rds", "09302004/bulk_POR_09302004.rds", "12312004/bulk_POR_12312004.rds", "03312005/bulk_POR_03312005.rds", "06302005/bulk_POR_06302005.rds", "09302005/bulk_POR_09302005.rds", "12312005/bulk_POR_12312005.rds", "03312006/bulk_POR_03312006.rds", "06302006/bulk_POR_06302006.rds", "09302006/bulk_POR_09302006.rds", "12312006/bulk_POR_12312006.rds", "03312007/bulk_POR_03312007.rds", "06302007/bulk_POR_06302007.rds", "09302007/bulk_POR_09302007.rds", "12312007/bulk_POR_12312007.rds", "03312008/bulk_POR_03312008.rds", "06302008/bulk_POR_06302008.rds", "09302008/bulk_POR_09302008.rds", "12312008/bulk_POR_12312008.rds", "03312009/bulk_POR_03312009.rds", "06302009/bulk_POR_06302009.rds", "09302009/bulk_POR_09302009.rds", "12312009/bulk_POR_12312009.rds", "03312010/bulk_POR_03312010.rds", "06302010/bulk_POR_06302010.rds", "09302010/bulk_POR_09302010.rds", "12312010/bulk_POR_12312010.rds", "03312011/bulk_POR_03312011.rds", "06302011/bulk_POR_06302011.rds", "09302011/bulk_POR_09302011.rds", "12312011/bulk_POR_12312011.rds", "03312012/bulk_POR_03312012.rds", "06302012/bulk_POR_06302012.rds", "09302012/bulk_POR_09302012.rds", "12312012/bulk_POR_12312012.rds", "03312013/bulk_POR_03312013.rds", "06302013/bulk_POR_06302013.rds", "09302013/bulk_POR_09302013.rds", "12312013/bulk_POR_12312013.rds", "03312014/bulk_POR_03312014.rds", "06302014/bulk_POR_06302014.rds", "09302014/bulk_POR_09302014.rds", "12312014/bulk_POR_12312014.rds", "03312015/bulk_POR_03312015.rds", "06302015/bulk_POR_06302015.rds", "09302015/bulk_POR_09302015.rds", "12312015/bulk_POR_12312015.rds", "03312016/bulk_POR_03312016.rds", "06302016/bulk_POR_06302016.rds", "09302016/bulk_POR_09302016.rds", "12312016/bulk_POR_12312016.rds", "03312017/bulk_POR_03312017.rds", "06302017/bulk_POR_06302017.rds")

num <- length(reports)

the_code <- 0
rept_date <- as.Date(0, origin = "1970-01-01")
num_banks <- 0

for (i in 1:num){
    sch <- readRDS(url(paste0("https://github.com/Matt-Brigida/FFIEC_Call_Reports/blob/master/data/", reports[i], "$raw=true")))
    num_banks[i] <- length(unique(sch$IDRSSD))
    rept_date[i] <- as.Date(strsplit(strsplit(reports[i], "_")[[1]][3], "\\.")[[1]][1], "%m%d%Y")
}

result1 <- xts::as.xts(as.numeric(num_banks), order.by = rept_date)
hchart(result1)
})
```


### The Distribution of Bank Size

Here we look at the pdf of bank size over each quarter.

```{r echo=FALSE, message=FALSE, warning=FALSE, error=FALSE, eval = FALSE}
## RIAD3210 -- total equity capital on sch RIA
renderHighchart({
    
reportsRIA <- c("03312001/sch_RIA_03312001.rds", "06302001/sch_RIA_06302001.rds", "09302001/sch_RIA_09302001.rds", "12312001/sch_RIA_12312001.rds", "03312002/sch_RIA_03312002.rds", "06302002/sch_RIA_06302002.rds", "09302002/sch_RIA_09302002.rds", "12312002/sch_RIA_12312002.rds", "03312003/sch_RIA_03312003.rds", "06302003/sch_RIA_06302003.rds", "09302003/sch_RIA_09302003.rds", "12312003/sch_RIA_12312003.rds", "03312004/sch_RIA_03312004.rds", "06302004/sch_RIA_06302004.rds", "09302004/sch_RIA_09302004.rds", "12312004/sch_RIA_12312004.rds", "03312005/sch_RIA_03312005.rds", "06302005/sch_RIA_06302005.rds", "09302005/sch_RIA_09302005.rds", "12312005/sch_RIA_12312005.rds", "03312006/sch_RIA_03312006.rds", "06302006/sch_RIA_06302006.rds", "09302006/sch_RIA_09302006.rds", "12312006/sch_RIA_12312006.rds", "03312007/sch_RIA_03312007.rds", "06302007/sch_RIA_06302007.rds", "09302007/sch_RIA_09302007.rds", "12312007/sch_RIA_12312007.rds", "03312008/sch_RIA_03312008.rds", "06302008/sch_RIA_06302008.rds", "09302008/sch_RIA_09302008.rds", "12312008/sch_RIA_12312008.rds", "03312009/sch_RIA_03312009.rds", "06302009/sch_RIA_06302009.rds", "09302009/sch_RIA_09302009.rds", "12312009/sch_RIA_12312009.rds", "03312010/sch_RIA_03312010.rds", "06302010/sch_RIA_06302010.rds", "09302010/sch_RIA_09302010.rds", "12312010/sch_RIA_12312010.rds", "03312011/sch_RIA_03312011.rds", "06302011/sch_RIA_06302011.rds", "09302011/sch_RIA_09302011.rds", "12312011/sch_RIA_12312011.rds", "03312012/sch_RIA_03312012.rds", "06302012/sch_RIA_06302012.rds", "09302012/sch_RIA_09302012.rds", "12312012/sch_RIA_12312012.rds", "03312013/sch_RIA_03312013.rds", "06302013/sch_RIA_06302013.rds", "09302013/sch_RIA_09302013.rds", "12312013/sch_RIA_12312013.rds", "03312014/sch_RIA_03312014.rds", "06302014/sch_RIA_06302014.rds", "09302014/sch_RIA_09302014.rds", "12312014/sch_RIA_12312014.rds", "03312015/sch_RIA_03312015.rds", "06302015/sch_RIA_06302015.rds", "09302015/sch_RIA_09302015.rds", "12312015/sch_RIA_12312015.rds", "03312016/sch_RIA_03312016.rds", "06302016/sch_RIA_06302016.rds", "09302016/sch_RIA_09302016.rds", "12312016/sch_RIA_12312016.rds", "03312017/sch_RIA_03312017.rds", "06302017/sch_RIA_06302017.rds")

num <- length(reportsRIA)

the_code <- 0
rept_date <- as.Date(0, origin = "1970-01-01")
avg_size <- 0

for (i in 1:num){
    sch <- readRDS(paste0("../../data/", reportsRIA[i]))
    avg_size[i] <- sum(sch$RIAD3210, na.rm = TRUE) / length(sch$IDRSSD)
    rept_date[i] <- as.Date(strsplit(strsplit(reportsRIA[i], "_")[[1]][3], "\\.")[[1]][1], "%m%d%Y")
}

result2 <- xts::as.xts(as.numeric(avg_size), order.by = rept_date)
hchart(result2)
})
```

